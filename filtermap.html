<!DOCTYPE html>
    <html lang="en">
        <head>
            <meta charset="utf-8">
            <title>D3 Test</title>
            <script type="text/javascript" src="d3/d3.js"></script>
        </head>
        <style type="text/css">


        </style>
        <body>

          <div id="newchart">
                <div id="chartname">
                    <h2>Filter the Airbnb in NYC</h2>
                </div>
                  <div class='radio'>
                      <label class='radio-inline'>
                          <input type="radio" id="rmtype" name="rmtype" value="privaterm" checked="checked"> Private Room
                      </label>
                      <label class='radio-inline'>
                          <input type="radio" id="rmtype" name="rmtype" value="sharedrm"> Shared Room
                      </label>
                      <label class='radio-inline'>
                          <input type="radio" id="rmtype" name="rmtype" value="entireapt"> Entire Apartment
                      </label>
                      <hr>
                       <label class='radio-inline'>
                          <input type="radio" id ="ppl" name="ppl" value="1" checked="checked"> 1
                      </label>
                      <label class='radio-inline'>
                          <input type="radio" id ="ppl" name="ppl" value="2"> 2
                      </label>
                      <label class='radio-inline'>
                          <input type="radio" id ="ppl" name="ppl" value="3"> 3
                      </label>
                      <label class='radio-inline'>
                          <input type="radio" id ="ppl" name="ppl" value="4"> 4
                      </label>
                      <label class='radio-inline'>
                          <input type="radio" id ="ppl" name="ppl" value="5"> 5+
                      </label>
                  </div>
                
               
            </div>
        </body>


            
          <script type="text/javascript">
          // Your beautiful D3 code will go here
          //https://www.dashingd3js.com/lessons/geojson
           var margin_map = {top: 0, right: 0, bottom: 0, left: 0},
              width_map = 600 - margin_map.left - margin_map.right,
              height_map = 500 - margin_map.top - margin_map.bottom;

          var svgmap = d3.select("body").append("svg")
                        .attr("width", width_map)
                        .attr("height", height_map);

          
          var projection = d3.geoMercator().scale(45000).translate([width_map /2, height_map/2]).center([-74.0, 40.7]);
          var path = d3.geoPath().projection(projection);

         // Load in my states data!
            d3.csv("airbnbNYC_2017.csv", function(data) {
               //----------draw histogram------------
               d3.json("boroughs.geojson", function(json) {

                //map
                // Bind the data to the SVG and create one path per GeoJSON feature
                    svgmap.selectAll("path")
                      .data(json.features)
                      .enter()
                      .append("path")
                      .attr("d", path)
                      .style("stroke", "#fff")
                      .style("stroke-width", "1")
                      .style("fill", function(d) {
                          // Get data value
                          var value = d.properties.BoroName;

                          if (value == "Staten Island") {
                            return "rgb(107,174,214)";
                          } else if (value == "Bronx") {
                            return "rgb(213,222,217)";
                          } else if (value == "Manhattan"){
                            return "rgb(222,235,247)";
                          }else if (value == "Brooklyn"){
                            return "rgb(198,219,239)";
                          }else if (value == "Queens"){
                            return "rgb(158,202,225)";
                          }
                        });


                var nest = d3.nest()
                              .key(function(d) {return d.room_type})
                              //.rollup(function (v) {return v.length})
                              .entries(data)
                              ;


                console.log(nest);
                
                d3.selectAll("#rmtype").on("change", roomType)
                                      ;

                function roomType() {
                  console.log(nest);
                   brushedData = [];
                    var value = this.value;
                    if (value === "privaterm") {
                        for (var i = 0;
                         i < nest[0].values.length;
                          i++){
                          brushedData.push(nest[0].values[i]);
                        }

                    } else if (value === "sharedrm") {
                        for (var i = 0;
                         i < nest[2].values.length;
                          i++){
                          brushedData.push(nest[2].values[i]);
                        }
                    } else if (value == "entireapt") {
                        for (var i = 0;
                         i < nest[1].values.length;
                          i++){
                          brushedData.push(nest[1].values[i]);
                        }
                    }
                    //console.log(brushedData); 
                  //drawCircle(brushedData);
                  d3.selectAll("#ppl").on("change", noOfPeople);
                }

                d3.selectAll("#ppl").on("change", noOfPeople);
                function noOfPeople() {
                  //console.log(nest);
                  pplData = []
                    var value = this.value;
                    if (value === "1") {
                        for (var i = 0 ; i < brushedData.length; i++){
                            if (brushedData[i].accommodates >= value){
                                pplData.push(brushedData[i]);
                            }
                        }; 

                    } else if (value === "2") {
                        for (var i = 0 ; i < brushedData.length; i++){
                            if (brushedData[i].accommodates >= value){
                                pplData.push(brushedData[i]);
                            }
                        }; 
                    } else if (value == "3") {
                        for (var i = 0 ; i < brushedData.length; i++){
                            if (brushedData[i].accommodates >= value){
                                pplData.push(brushedData[i]);
                            }
                        }; 
                    }else if (value == "4") {
                        for (var i = 0 ; i < brushedData.length; i++){
                            if (brushedData[i].accommodates >= value){
                                pplData.push(brushedData[i]);
                            }
                        }; 
                    }else if (value == "5") {
                        for (var i = 0 ; i < brushedData.length; i++){
                            if (brushedData[i].accommodates >= value){
                                pplData.push(brushedData[i]);
                            }
                        }; 
                    }
                    console.log(pplData); 
                  drawCircle(pplData);
                }

                function drawCircle(datan){
                  //remove all circle first
                  svgmap.selectAll("circle").remove();
                  //console.log(bdata);
                  //draw circle
                  var circles = svgmap.selectAll("circle")
   
                                .data(datan) //change to range of new data
                                .enter()
                                .append("circle")
                                .attr("cx", function(d) {
                                  return projection([d.longitude, d.latitude])[0];
                                })
                                .attr("cy", function(d) {
                                  return projection([d.longitude, d.latitude])[1];
                                })
                                //.attr("class", "non_brushed")
                                .attr("r", 2)
                                  .style("fill",function(d) {
                                    // Get data value
                                    var value = d.price;

                                    if (value  < 50) {
                                      return "red";
                                    } else if (value < 100) {
                                      return "blue";
                                    } else if (value < 200){
                                      return "rgb(217,81,67)";
                                    }else {
                                      return "rgb(200,81,67)";
                                    }
                                  })
                                  .style("opacity", 0.85) ;
                }

              });
      });         

            </script>

</html>
